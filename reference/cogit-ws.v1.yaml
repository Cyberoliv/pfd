openapi: 3.0.0
info:
  title: cogit
  version: '1.0'
  contact:
    name: 'Penthai & Olivier'
  description: "Passerelle d'échange entre l'IHM et les autres outils (Bitbucket & Jira)"
servers:
  - url: 'http://localhost:3000'
tags:
  - name: cogit
paths:
  /briques:
    get:
      summary: Liste des briques
      tags: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                title: brique
                type: array
                x-examples:
                  cokpit:
                    projectKey: cokpit
                    repoName: cokpit
                    repoSlug: cokpit
                  portik:
                    projectKey: TEAM_PFD
                    repoName: portik
                    repoSlug: portik
                  amir:
                    projectKey: AMIR
                    repoName: amir
                    repoSlug: amir
                description: Brique au sens cogit
                items:
                  $ref: '#/components/schemas/Brique'
        '202':
          description: Accepted
        '400':
          description: Bad Request
        '401':
          description: Unauthorized
      operationId: get-briques
      description: Liste toutes les briques de Bitbucket
      parameters:
        - schema:
            type: string
          in: query
          name: permission
          description: Droits sur les repos
    parameters: []
  '/{projectKey}/{repoSlug}/versions':
    get:
      summary: "Liste les versions d'une brique (repo)"
      tags: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ParentVersion'
              examples: {}
      operationId: get-versions
      description: 'Recherche les versions "parent (Release ?)" + toutes les versions associées'
    parameters:
      - schema:
          type: string
        name: projectKey
        in: path
        description: Clé du projet
        required: true
      - schema:
          type: string
        name: repoSlug
        in: path
        description: 'Slug du repo ("Friendly name")'
        required: true
  '/{projectKey}/{repoSlug}/branches':
    parameters:
      - schema:
          type: string
        name: projectKey
        in: path
        required: true
        description: Clé du projet
      - schema:
          type: string
        name: repoSlug
        in: path
        required: true
        description: 'Slug du repo ("Friendly name")'
    get:
      summary: "Liste les branches d'une brique (repo)"
      tags: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Branche'
              examples: {}
      operationId: get-projectKey-repoSlug-branches
      description: "Liste les branches d'une brique (repo)"
  '/{projectKey}/{repoSlug}/pull-requests':
    get:
      summary: Liste les Pull-Requests
      tags: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PullRequest'
      operationId: get-pull-requests
      description: Liste toutes les pull-requests
      security:
        - Basic Auth: []
    parameters:
      - schema:
          type: string
        name: projectKey
        in: path
        required: true
        description: Clé du projet
      - schema:
          type: string
        name: repoSlug
        in: path
        required: true
        description: 'Slug du repo ("Friendly name")'
  /tickets:
    get:
      summary: Liste de tickets Jira
      tags: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Ticket'
      operationId: get-tickets
      description: Liste de tickets Jira
components:
  schemas:
    Brique:
      title: Brique
      type: object
      x-examples:
        cokpit:
          name: cokpit
        portik:
          name: portik
        amir:
          name: amir
      description: Brique au sens cogit
      properties:
        name:
          type: string
          description: Clé du projet dans BitBucket
    ParentVersion:
      title: ParentVersion
      type: object
      x-examples:
        '1.37':
          name: '1.37'
          versions:
            - name: 1.37.0-a1
              createdDate: '20201801'
              lifeCycle: Alpha
              currentCycle: a1
              description: Lalalala description 1
            - name: 1.37.0-rc3
              createdDate: '20201804'
              lifeCycle: Release Candidate
              currentCycle: rc3
              description: Lalalala description 2
            - name: 1.37.0
              createdDate: '20201806'
              lifeCycle: Livrée
              currentCycle: ''
              description: Lalalala description 3
      description: "Modèle d'une version X.Y\n+ Toutes ses versions \n   - X.Y.Z-aNN \n   - X.Y.Z-rcNN \n   - X.Y.Z"
      properties:
        name:
          type: string
          description: Nom au format X.Y
        versions:
          type: array
          description: Liste de toutes les versions associées à la X.Y
          items:
            $ref: '#/components/schemas/Version'
    Version:
      title: Version
      type: object
      description: "Détail d'une version"
      properties:
        name:
          type: string
        createdDate:
          type: string
          description: Date à laquelle a été posé le TAG dans GIT
        lifeCycle:
          type: string
        currentCycle:
          type: string
        description:
          type: string
      x-examples:
        Version Alpha:
          name: 1.37.0-a1
          createdDate: '20201801'
          lifeCycle: Alpha
          currentCycle: a1
          description: Lalalala description 1
        Version RC:
          name: 1.37.0-rc3
          createdDate: '20201804'
          lifeCycle: Release Candidate
          currentCycle: rc3
          description: Lalalala description 2
        Livrée:
          name: 1.37.0
          createdDate: '20201806'
          lifeCycle: Livrée
          currentCycle: ''
          description: Lalalala description 3
    Branche:
      title: Branche
      type: object
      x-examples:
        Develop:
          id: refs/heads/develop
          displayId: develop
        Master:
          id: refs/heads/master
          displayId: master
        Feature Cokpit:
          id: refs/heads/feature/COK-593-mise-en-oeuvre-abandon-de-version
          displayId: feature/COK-593-mise-en-oeuvre-abandon-de-version
      description: "Représentation d'une branche"
      properties:
        id:
          type: string
          description: ID Bitbuket de la branche
        displayId:
          type: string
          description: "Nom d'affichage"
    PullRequest:
      title: PullRequest
      type: object
      description: Modèle de la Pull-Request
      x-examples:
        Pull-request Cokpit:
          id: 41
          title: Feature/COK-540 new artifactory filtrage et mise a jour des pom
          description: "* COK-540: [New Artifactory] Filtrage et mise à jour des pom\n\n    Task-Url: https://jira.retraite.aa/browse/COK-540\n\nJ'ai supprimé l'antérieur car j'ai changé ce que j'avait fait. \nMerci pour vos commentaires, c'est plus simple maintenant."
          state: OPEN
          createdDate: '2020-06-23'
          fromRef: feature/COK-540-new-artifactory-filtrage-et-mise-a-jour-des-pom
          toRef: develop
        Pull-request Demo_git:
          id: 11
          title: Release/1.1
          description: "* add a common feature\r\n* add an amaury feature\r\n* WEB-5196"
          state: OPEN
          createdDate: '2020-06-23'
          fromRef: release/1.1
          toRef: master
      properties:
        id:
          type: integer
          description: ID de la pull-request
        title:
          type: string
          description: Titre de la pull-request
        description:
          type: string
          description: description de la pull-resquest
        state:
          type: string
          description: etat de la pull-request
        createdDate:
          description: date de creation
          format: date
          type: string
        fromRef:
          type: string
          description: "d'où provient la pull-request"
        toRef:
          type: string
          description: vers où va la pull-request
    Ticket:
      title: Ticket
      type: object
      properties:
        id:
          type: integer
        key:
          type: string
        type:
          type: string
        state:
          type: string
        priority:
          type: string
      description: "Modèle d'un ticket"
      x-examples:
        ticket: {}
  securitySchemes:
    Basic Auth:
      type: http
      scheme: basic
